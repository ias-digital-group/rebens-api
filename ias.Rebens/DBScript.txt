ALTER TABLE [dbo].[Customer] ADD [WirecardId] [nvarchar](50) NULL
GO


/****** Object:  Table [dbo].[Order]    Script Date: 10/31/2019 9:57:03 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[Order](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdCustomer] [int] NOT NULL,
	[IdOperation] [int] NOT NULL,
	[DispId] [nvarchar](50) NOT NULL,
	[Subtotal] [money] NOT NULL,
	[Discount] [money] NOT NULL,
	[Total] [money] NOT NULL,
	[TotalItems] [int] NOT NULL,
	[IP] [nvarchar](50) NULL,
	[WirecardId] [nvarchar](50) NULL,
	[Status] [nvarchar](50) NULL,
	[PaymentType] [nvarchar](50) NOT NULL,
	[WirecardDate] [datetime] NULL,
	[Created] [datetime] NOT NULL,
	[Modified] [datetime] NOT NULL,
 CONSTRAINT [PK_Order] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[Order]  WITH CHECK ADD  CONSTRAINT [FK_Order_Customer] FOREIGN KEY([IdCustomer])
REFERENCES [dbo].[Customer] ([Id])
GO

ALTER TABLE [dbo].[Order] CHECK CONSTRAINT [FK_Order_Customer]
GO

ALTER TABLE [dbo].[Order]  WITH CHECK ADD  CONSTRAINT [FK_Order_Operation] FOREIGN KEY([IdOperation])
REFERENCES [dbo].[Operation] ([Id])
GO

ALTER TABLE [dbo].[Order] CHECK CONSTRAINT [FK_Order_Operation]
GO



/****** Object:  Table [dbo].[OrderItem]    Script Date: 10/31/2019 9:57:25 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[OrderItem](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdOrder] [int] NOT NULL,
	[IdCourse] [int] NOT NULL,
	[Name] [nvarchar](500) NOT NULL,
	[Price] [money] NOT NULL,
	[Voucher] [nvarchar](1000) NULL,
	[Created] [datetime] NOT NULL,
	[Modified] [datetime] NOT NULL,
 CONSTRAINT [PK_OrderItem] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[OrderItem]  WITH CHECK ADD  CONSTRAINT [FK_OrderItem_Course] FOREIGN KEY([IdCourse])
REFERENCES [dbo].[Course] ([Id])
GO

ALTER TABLE [dbo].[OrderItem] CHECK CONSTRAINT [FK_OrderItem_Course]
GO

ALTER TABLE [dbo].[OrderItem]  WITH CHECK ADD  CONSTRAINT [FK_OrderItem_Order] FOREIGN KEY([IdOrder])
REFERENCES [dbo].[Order] ([Id])
GO

ALTER TABLE [dbo].[OrderItem] CHECK CONSTRAINT [FK_OrderItem_Order]
GO


/****** Object:  Table [dbo].[WirecardPayment]    Script Date: 10/31/2019 9:57:39 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[WirecardPayment](
	[Id] [nvarchar](50) NOT NULL,
	[IdOrder] [int] NOT NULL,
	[Status] [nvarchar](50) NOT NULL,
	[Amount] [money] NOT NULL,
	[Method] [nvarchar](50) NOT NULL,
	[BilletLineCode] [nvarchar](500) NULL,
	[BilletLink] [nvarchar](500) NULL,
	[BilletLinkPrint] [nvarchar](500) NULL,
	[CardBrand] [nvarchar](50) NULL,
	[CardFirstSix] [nvarchar](10) NULL,
	[CardLastFour] [nvarchar](10) NULL,
	[CardHolderName] [nvarchar](200) NULL,
	[Created] [datetime] NOT NULL,
	[Modified] [datetime] NOT NULL,
 CONSTRAINT [PK_WirecardPayment] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[WirecardPayment]  WITH CHECK ADD  CONSTRAINT [FK_WirecardPayment_Order] FOREIGN KEY([IdOrder])
REFERENCES [dbo].[Order] ([Id])
GO

ALTER TABLE [dbo].[WirecardPayment] CHECK CONSTRAINT [FK_WirecardPayment_Order]
GO



ALTER TABLE CourseGraduationType ADD Parent INT NULL
GO

UPDATE CourseGraduationType SET Parent = 1
GO

ALTER TABLE CourseGraduationType ALTER COLUMN Parent INT NOT NULL
GO



ALTER TABLE Course ADD CourseBegin NVARCHAR(100) NULL
GO


UPDATE Course SET CourseBegin = '2º Semestre de 2019' WHERE StartDate IS NOT NULL AND StartDate BETWEEN '2019-07-01' AND '2019-12-31'
UPDATE Course SET CourseBegin = '1º Semestre de 2020' WHERE StartDate IS NOT NULL AND StartDate BETWEEN '2020-01-01' AND '2020-06-30'
UPDATE Course SET CourseBegin = '2º Semestre de 2020' WHERE StartDate IS NOT NULL AND StartDate BETWEEN '2020-07-01' AND '2020-12-31'
UPDATE Course SET CourseBegin = '1º Semestre de 2021' WHERE StartDate IS NOT NULL AND StartDate BETWEEN '2021-01-01' AND '2021-06-30'
UPDATE Course SET CourseBegin = '2º Semestre de 2021' WHERE StartDate IS NOT NULL AND StartDate BETWEEN '2021-07-01' AND '2021-12-31'


ALTER TABLE Course ADD [Name] NVARCHAR(200) NULL
GO
UPDATE Course SET [Name] = Title 
GO
ALTER TABLE Course ALTER COLUMN [Name] NVARCHAR(200) NOT NULL
GO